# Chtholly 编译器开发路线图 (RoadMap)

本文档旨在规划和跟踪 Chtholly 编译器的开发过程。我们采用 Scrum 作为敏捷开发框架，并结合测试驱动开发 (TDD) 来保证代码质量。

## 产品待办清单 (Product Backlog)

### Sprint 1: 项目奠基与核心词法分析

**目标:** 搭建项目基础架构，实现对 Chtholly 语言核心 Token 的词法分析。

*   **PBI-1.1:** [未开始] 创建项目结构
    *   **任务 1.1.1:** 初始化 Cargo 项目。
    *   **任务 1.1.2:** 配置 `Cargo.toml`，添加 `llvm-sys` 等基础依赖。
    *   **任务 1.1.3:** 创建 `.gitignore` 文件，忽略 `target/` 和其他无关文件。
    *   **任务 1.1.4:** 建立 `src/` 目录结构 (例如 `src/lexer`, `src/parser`, `src/ast`, `src/codegen`)。
*   **PBI-1.2:** [未开始] 实现词法分析器 (Lexer)
    *   **任务 1.2.1 (TDD):** 编写单元测试，覆盖所有关键字 (e.g., `if`, `else`, `while`, `fn`) 的识别。
    *   **任务 1.2.2 (TDD):** 编写单元测试，覆盖标识符 (identifiers) 的识别。
    *   **任务 1.2.3 (TDD):** 编写单元测试，覆盖数字字面量 (integer and float literals) 的识别。
    *   **任务 1.2.4 (TDD):** 编写单元测试，覆盖操作符 (e.g., `+`, `-`, `*`, `/`, `=`, `==`) 的识别。
    *   **任务 1.2.5 (TDD):** 编写单元测试，覆盖分隔符 (e.g., `(`, `)`, `{`, `}`, `,`, `;`) 的识别。
    *   **任务 1.2.6:** 实现词法分析器逻辑，使所有测试通过。
*   **PBI-1.3:** [未开始] 持续集成 (CI)
    *   **任务 1.3.1:** 设置 GitHub Actions，配置 Rust 的构建和测试流程。

### Sprint 2: 抽象语法树 (AST) 与基础语法分析

**目标:** 定义 AST 结构，并实现对基本表达式和变量声明的语法分析。

*   **PBI-2.1:** [未开始] 定义核心 AST 节点
    *   **任务 2.1.1:** 定义表达式 (Expression) 相关的 AST 节点 (e.g., `NumberExpr`, `VariableExpr`, `BinaryExpr`)。
    *   **任务 2.1.2:** 定义语句 (Statement) 相关的 AST 节点 (e.g., `LetStmt`, `ExprStmt`)。
*   **PBI-2.2:** [未开始] 实现语法分析器 (Parser)
    *   **任务 2.2.1 (TDD):** 编写测试，解析简单的数字字面量表达式。
    *   **任务 2.2.2 (TDD):** 编写测试，解析变量声明语句 (`let a = 10;`)。
    *   **任务 2.2.3 (TDD):** 编写测试，解析包含二元运算符的表达式 (e.g., `1 + 2 * 3`)，并处理运算符优先级。
    *   **任务 2.2.4:** 实现递归下降解析器，处理表达式和变量声明。

### Sprint 3: 代码生成与 LLVM IR

**目标:** 将 AST 转换为 LLVM IR，实现简单表达式的编译。

*   **PBI-3.1:** [未开始] LLVM 代码生成器 (Code Generator)
    *   **任务 3.1.1:** 集成 `llvm-sys` 或更高级的 Rust-LLVM 绑定库。
    *   **任务 3.1.2 (TDD):** 编写测试，为数字字面量生成对应的 LLVM IR 常量。
    *   **任务 3.1.3 (TDD):** 编写测试，为变量声明生成 `alloca` 和 `store` 指令。
    *   **任务 3.1.4 (TDD):** 编写测试，为二元运算表达式生成对应的 LLVM IR 运算指令。
*   **PBI-3.2:** [未开始] 端到端 (End-to-End) 测试
    *   **任务 3.2.1:** 创建一个简单的 Chtholly 源码文件 (`let x = 5;`)。
    *   **任务 3.2.2:** 编写脚本，调用编译器生成 LLVM IR，并使用 `llc` 和 `clang` 编译成可执行文件。
    *   **任务 3.2.3:** 运行可执行文件，验证其行为是否符合预期 (可能需要结合 GDB 或返回值)。

### Sprint 4: 函数定义与调用

**目标:** 完整支持函数的定义和调用。

*   **PBI-4.1:** [未开始] 扩展 AST 和 Parser
    *   **任务 4.1.1:** 在 AST 中添加 `FunctionPrototype` 和 `Function` 节点。
    *   **任务 4.1.2 (TDD):** 编写测试，解析函数定义 (`fn add(a, b) { ... }`)。
    *   **任务 4.1.3 (TDD):** 编写测试，解析函数调用 (`add(1, 2)`)。
*   **PBI-4.2:** [未开始] 扩展代码生成器
    *   **任务 4.2.1 (TDD):** 编写测试，为函数定义生成 LLVM Function IR。
    *   **任务 4.2.2 (TDD):** 编写测试，为函数调用生成 LLVM `call` 指令。
    *   **任务 4.2.3 (TDD):** 编写测试，处理函数返回值 (`return` 语句)。

---

*后续 Sprint 将会包含控制流 (if/else, while), 类型系统, 错误处理, 标准库等更高级的功能。此文档将持续更新以反映项目进度。*

## 进度跟踪

| Sprint | 状态 | 开始日期 | 结束日期 |
|--------|------|----------|----------|
| 1      | 未开始 | TBD      | TBD      |
| 2      | 未开始 | TBD      | TBD      |
| 3      | 未开始 | TBD      | TBD      |
| 4      | 未开始 | TBD      | TBD      |
