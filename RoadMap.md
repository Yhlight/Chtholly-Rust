# Chtholly 编译器开发路线图

本文档概述了 Chtholly 编译器的开发计划。该项目将采用基于 Scrum 的方法，并以测试驱动开发（TDD）为重点。

## 项目里程碑

1.  **里程碑 1：核心语言功能（Sprint 1-4）**
    *   目标：实现语言的基本构建块。
    *   状态：`进行中`

2.  **里程碑 2：面向对象功能（Sprint 5-7）**
    *   目标：实现类、结构体及相关功能。
    *   状态：`未开始`

3.  **里程碑 3：高级语言功能（Sprint 8-10）**
    *   目标：实现泛型、特征（请求）和模块。
    *   状态：`未开始`

4.  **里程碑 4：标准库和工具（持续进行）**
    *   目标：开发一个基本的标准库和编译器工具。
    *   状态：`未开始`

## Sprint 待办事项

---

### **Sprint 1：项目设置和基本语法**

*   **目标：** 设置项目结构并解析基本的语言结构。
*   **状态：** `已完成`
*   **任务：**
    *   [x] **项目设置：**
        *   [x] 使用 Cargo 初始化 Rust 项目。
        *   [x] 添加 LLVM 17 绑定（`inkwell` 或 `llvm-sys`）。
        *   [x] 添加一个解析库（`pest` 或 `lalrpop`）。
        *   [x] 设置基本的项目结构（例如 `src/main.rs`、`src/lexer.rs`、`src/parser.rs`）。
        *   [x] 创建一个 `.gitignore` 文件。
    *   [x] **编译器驱动程序：**
        *   [x] 实现一个命令行界面来读取 `.cns` 文件。
    *   [x] **词法分析器（Tokenizer）：**
        *   [x] 实现注释（单行和多行）的词法分析。
        *   [x] 实现关键字（`fn`、`let`、`mut` 等）的词法分析。
        *   [x] 实现标识符、字面量（整数、字符串）和运算符的词法分析。
    *   [x] **解析器（AST）：**
        *   [x] 为基本结构定义抽象语法树（AST）节点。
        *   [x] 实现 `main` 函数的解析。
        *   [x] 实现变量声明（`let` 和 `mut`）的解析。
    *   [x] **代码生成（LLVM IR）：**
        *   [x] 为一个简单的“Hello, World!”程序生成 LLVM IR。
        *   [x] 编译并运行第一个 Chtholly 程序。

---

### **Sprint 2：数据类型和表达式**

*   **目标：** 实现对基本数据类型和表达式的支持。
*   **状态：** `进行中`
*   **任务：**
    *   [ ] **类型系统：**
        *   [ ] 实现基本类型：`i32`、`f64`、`char`、`bool`、`string`。
        *   [ ] 实现变量声明的类型检查。
        *   [ ] 实现类型推断。
        *   [ ] 实现 `mut` 关键字的语义检查。
    *   [ ] **表达式：**
        *   [x] 实现算术表达式（`+`、`-`、`*`、`/`、`%`）的解析。
        *   [x] 实现比较表达式（`==`、`!=`、`<`、`>`、`<=`、`>=`）的解析。
        *   [x] 实现逻辑表达式（`&&`、`||`、`!`）的解析。
    *   [ ] **代码生成：**
        *   [ ] 为表达式生成 LLVM IR。
        *   [ ] 实现 `type_cast<T>()`。

---

### **Sprint 3：控制流**

*   **目标：** 实现控制流结构。
*   **状态：** `未开始`
*   **任务：**
    *   [ ] **条件语句：**
        *   [ ] 实现 `if-else` 语句的解析和代码生成。
    *   [ ] **循环：**
        *   [ ] 实现 `while` 循环的解析和代码生成。
        *   [ ] 实现 `for` 循环的解析和代码生成。
        *   [ ] 实现 `do-while` 循环的解析和代码生成。
    *   [ ] **Switch 语句：**
        *   [ ] 实现 `switch-case` 语句的解析和代码生成，包括 `fallthrough`。

---

### **Sprint 4：函数和作用域**

*   **目标：** 实现函数定义、调用和作用域规则。
*   **状态：** `未开始`
*   **任务：**
    *   [ ] **函数：**
        *   [ ] 实现函数定义和调用的解析和代码生成。
        *   [ ] 实现对函数参数和返回值的支持。
    *   [ ] **作用域：**
        *   [ ] 实现一个符号表来管理不同作用域中的变量和函数。
    *   [ ] **所有权和借用（初步）：**
        *   [ ] 实现变量的基本移动语义。
        *   [ ] 实现基本借用（`&` 和 `&mut`）。

---

### **Sprint 5：结构体和类（第 1 部分）**

*   **目标：** 实现基本的结构体和类。
*   **状态：** `未开始`
*   **任务：**
    *   [ ] **结构体：**
        *   [ ] 实现 `struct` 定义的解析和语义分析。
        *   [ ] 实现结构体实例化（聚合和指定初始化）。
        *   [ ] 实现成员访问。
    *   [ ] **类（基本）：**
        *   [ ] 实现 `class` 定义的解析和语义分析。
        *   [ ] 实现成员变量（`let` 和 `mut`）。
        *   [ ] 实现构造函数。

---

### **Sprint 6：类（第 2 部分）和枚举**

*   **目标：** 实现高级类功能和枚举。
*   **状态：** `未开始`
*   **任务：**
    *   [ ] **类（高级）：**
        *   [ ] 实现成员函数（包括 `self`、`&self`、`&mut self`）。
        *   [ ] 实现访问修饰符（`public`、`private`）。
        *   [ ] 实现析构函数（`~`）。
    *   [ ] **枚举：**
        *   [ ] 实现 `enum` 定义的解析。
        *   [ ] 实现对带有关联数据的枚举的支持。
        *   [ ] 在 `if` 和 `switch` 语句中实现枚举解构。

---

### **Sprint 7：数组和 Lambda**

*   **目标：** 实现对数组和 lambda 表达式的支持。
*   **状态：** `未开始`
*   **任务：**
    *   [ ] **数组：**
        *   [ ] 实现静态数组（`i32[4]`）的解析和代码生成。
        *   [ ] 实现动态数组（`i32[]`）的解析和代码生成。
        *   [ ] 实现数组元素访问。
    *   [ ] **Lambda：**
        *   [ ] 实现 lambda 表达式的解析。
        *   [ ] 实现变量捕获（`[]`、`&`、`&mut`）。

---

### **Sprint 8：泛型**

*   **目标：** 实现泛型函数和类。
*   **状态：** `未开始`
*   **任务：**
    *   [ ] **泛型函数：**
        *   [ ] 实现泛型函数定义的解析。
        *   [ ] 实现泛型函数的类型检查和单态化。
        *   [ ] 实现对默认泛型类型和特化的支持。
    *   [ ] **泛型类：**
        *   [ ] 实现泛型类定义的解析。
        *   [ ] 实现泛型类的类型检查和单态化。

---

### **Sprint 9：请求（特征）**

*   **目标：** 实现用于定义接口的 `request` 系统。
*   **状态：** `未开始`
*   **任务：**
    *   [ ] **请求定义：**
        *   [ ] 实现 `request` 定义的解析。
        *   [ ] 实现对关联类型（`type item`）的支持。
    *   [ ] **请求实现：**
        *   [ ] 实现类的 `require` 关键字。
        *   [ ] 实现请求方法的静态分发。
    *   [ ] **内置请求：**
        *   [ ] 实现 `iterator` 请求。

---

### **Sprint 10：模块和错误处理**

*   **目标：** 实现模块系统和用于错误处理的 `Result<T, E>`。
*   **状态：** `未开始`
*   **任务：**
    *   [ ] **模块：**
        *   [ ] 实现 `import` 和 `use` 语句。
        *   [ ] 实现模块解析（基于文件和标准库）。
        *   [ ] 实现 `package` 支持。
    *   [ ] **错误处理：**
        *   [ ] 实现 `Result<T, E>` 枚举。
        *   [ ] 实现用于错误传播的 `?` 运算符。
        *   [ ] 实现 `Result` 类型的模式匹配。
