# Chtholly 语言开发路线图 (RoadMap)

本项目遵循 Scrum 和测试驱动开发 (TDD) 的方法论，以增量、迭代的方式实现 Chtholly 语言。此路线图将开发过程分解为多个 Sprint，每个 Sprint 都专注于一组特定的、可交付的功能。

**项目愿景:** 创建一门以简洁、高性能和编译期安全为特征的编程语言，实现零成本抽象和极简运行时。

---

## Sprint 0: 项目奠基 (Project Foundation)

**目标:** 建立稳固的项目结构、开发环境、构建系统和核心依赖。

- [ ] **任务 1:** 创建 `.gitignore` 文件以实现版本控制。
- [ ] **任务 2:** 创建 `RoadMap.md` 文档来规划和跟踪项目进度。
- [ ] **任务 3:** 更新 `agents.md`，添加自动化环境设置脚本。
- [ ] **任务 4:** 使用 Cargo 初始化 Rust 项目。
- [ ] **任务 5:** 配置核心依赖，特别是 `inkwell` (或类似的 LLVM Rust 绑定)。
- [ ] **任务 6:** 实现一个基本的命令行界面 (CLI)，用于接收源文件名。
- [ ] **任务 7:** 建立基础的错误报告和日志记录机制。

---

## Sprint 1: 词法分析器 (Lexer)

**目标:** 将 Chtholly 源代码 (`.cns`) 文件转换为一个线性的 Token（词法单元）流。

- [ ] **任务 1:** 定义所有 Token 类型（关键字、标识符、字面量、运算符、分隔符等）。
- [ ] **任务 2:** 实现 Lexer 模块，能够逐个字符读取源代码并生成 Token。
- [ ] **任务 3 (TDD):** 为所有单字符和多字符运算符编写测试。
- [ ] **任务 4 (TDD):** 为所有关键字编写测试。
- [ ] **任务 5 (TDD):** 为不同类型的字面量（整数、浮点数、字符、字符串）编写测试。
- [ ] **任务 6 (TDD):** 为单行 (`//`) 和多行 (`/* */`) 注释的正确处理编写测试。
- [ ] **任务 7 (TDD):** 为位置跟踪（行号、列号）编写测试，以便后续提供更清晰的错误信息。

---

## Sprint 2: 抽象语法树 (AST) 与解析器 (Parser)

**目标:** 接收 Lexer 生成的 Token 流，并构建一个能够准确表示代码结构的抽象语法树 (AST)。

- [ ] **任务 1:** 定义 AST 节点的数据结构（表达式、语句、声明、函数定义等）。
- [ ] **任务 2:** 实现 Parser 模块，采用自顶向下的递归下降解析策略。
- [ ] **任务 3 (TDD):** 解析变量声明 (`let`, `mut`)，包括类型注解和推导。
- [ ] **任务 4 (TDD):** 实现表达式解析，正确处理运算符优先级和结合性。
- [ ] **任务 5 (TDD):** 解析函数定义 (`fn`)，包括参数和返回类型。
- [ ] **任务 6 (TDD):** 解析基本的控制流结构 (`if-else`, `while`, C-style `for`)。
- [ ] **任务 7 (TDD):** 解析函数调用表达式。

---

## Sprint 3: 语义分析与类型系统

**目标:** 遍历 AST，执行语义检查，并构建强大的类型系统，这是 Chtholly 安全性的核心。

- [ ] **任务 1:** 实现符号表 (Symbol Table) 来管理变量、函数及其作用域。
- [ ] **任务 2:** 实现类型检查器，验证变量赋值、函数参数和返回值的类型是否匹配。
- [ ] **任务 3:** 实现类型推导功能。
- [ ] **任务 4 (TDD):** 实现所有权 (Ownership) 语义检查，确保资源移动后原变量失效。
- [ ] **任务 5 (TDD):** 实现借用 (Borrowing) 语义检查，强制执行“读写互斥”规则。
- [ ] **任务 6 (TDD):** 实现生命周期 (Lifetime) 的初步检查，防止悬垂引用。
- [ ] **任务 7:** 实现 `type_cast<T>()` 的语义分析。

---

## Sprint 4: LLVM IR 代码生成

**目标:** 将经过语义分析的 AST 转换为 LLVM 中间表示 (IR)。

- [ ] **任务 1:** 设置 LLVM 的核心组件：`Context`, `Module`, `Builder`。
- [ ] **任务 2 (TDD):** 为函数定义生成 LLVM IR。
- [ ] **任务 3 (TDD):** 为变量声明和赋值生成代码，包括内存分配 (`alloca`)。
- [ ] **任务 4 (TDD):** 为整数、浮点数字面量生成 LLVM 常量。
- [ ] **任务 5 (TDD):** 为算术运算符和比较运算符生成对应的 LLVM 指令。
- [ ] **任务 6 (TDD):** 为 `if-else` 结构生成分支指令。
- [ ] **任务 7 (TDD):** 为 `while` 和 `for` 循环生成基本的代码块和跳转指令。

---

## Sprint 5: 复合数据类型 (Structs & Classes)

**目标:** 引入用户自定义的数据结构，扩展语言的表达能力。

- [ ] **任务 1:** 解析 `struct` 定义，并添加到符号表中。
- [ ] **任务 2 (TDD):** 实现 `struct` 的聚合初始化和指定初始化，并进行类型检查。
- [ ] **任务 3:** 为 `struct` 的成员访问生成 LLVM IR (`GEP` 指令)。
- [ ] **任务 4:** 解析 `class` 定义，包括成员变量和成员函数。
- [ ] **任务 5 (TDD):** 实现 `Self` 关键字和成员函数调用 (`self`, `&self`, `&mut self`) 的语义分析和代码生成。
- [ ] **任务 6:** 实现 `public` 和 `private` 权限修饰的语义检查。
- [ ] **任务 7 (TDD):** 实现 `class` 的构造函数和析构函数。

---

## Sprint 6: 高级流程控制与枚举

**目标:** 完善语言的流程控制能力并引入强大的枚举类型。

- [ ] **任务 1 (TDD):** 实现 `switch-case` 结构，包括 `break` 和 `fallthrough` 关键字。
- [ ] **任务 2 (TDD):** 实现 `do-while` 循环。
- [ ] **任务 3 (TDD):** 实现 `foreach` 循环 (需要与未来的 `iterator` 约束集成)。
- [ ] **任务 4:** 解析 `enum` 定义，包括带有关联数据的变体。
- [ ] **任务 5 (TDD):** 实现 `enum` 的模式匹配和自动解构，例如 `if (color::RGB(r, g, b)) {}`。

---

## Sprint 7: 泛型 (Generics)

**目标:** 实现泛型功能，支持编写灵活且可重用的代码。

- [ ] **任务 1:** 解析泛型函数和泛型类的定义。
- [ ] **任务 2:** 实现泛型代码的单态化 (Monomorphization) 过程，在编译期为每个具体的类型实例生成代码。
- [ ] **任务 3 (TDD):** 支持泛型函数的特例化和默认泛型参数。
- [ ] **任务 4 (TDD):** 支持泛型类及其成员函数的泛型。

---

## Sprint 8: 模块系统

**目标:** 构建模块系统，允许代码的组织、复用和封装。

- [ ] **任务 1:** 实现 `import` 和 `use` 语句的解析。
- [ ] **任务 2:** 实现文件解析和模块加载逻辑。
- [ ] **任务 3 (TDD):** 支持模块别名 (`import "..." as ...`) 以解决命名冲突。
- [ ] **任务 4:** 实现 `package` 命名空间。
- [ ] **任务 5:** 创建一个简单的标准库，如 `iostream` 模块，并提供 `println` 函数。

---

## Sprint 9: 约束系统 (Requests) 与错误处理

**目标:** 实现 Chtholly 的 trait 系统（`request`）和现代化的错误处理机制。

- [ ] **任务 1:** 解析 `request` 定义及其关联函数和关联类型。
- [ ] **任务 2 (TDD):** 实现 `class ... require ...` 语法，并强制类实现所要求的 `request`。
- [ ] **任务 3 (TDD):** 实现关联类型 (`type item = ...`) 的解析和类型替换。
- [ ] **任务 4:** 实现 `iterator` 模块和相关的内置约束。
- [ ] **任务 5:** 在标准库中实现 `Result<T, E>` 和 `optional<T>` 类型。
- [ ] **任务 6 (TDD):** 实现 `?` 操作符的语法糖，用于错误传播。

---

## Sprint 10: 打包、发布与文档

**目标:** 完善编译器，提供工具链，并撰写文档。

- [ ] **任务 1:** 实现一个构建工具/驱动程序，可以编译 `.cns` 文件并链接生成可执行文件。
- [ ] **任务 2:** 优化编译器的错误提示信息，使其更友好、更精确。
- [ ] **任务 3:** 编写语言的官方文档。
- [ ] **任务 4:** 进行性能分析和代码重构。
- [ ] **任务 5:** 准备发布 1.0 版本。
